<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>태양계 정복 – 이벤트코인 관리센터</title>

  <style>
    /* ===== (CSS는 기존과 동일, PayApp과 무관) ===== */
    :root{
      --bg-gradient: radial-gradient(circle at top left,#1f2937,#020617 60%);
      --card-bg: rgba(15,23,42,0.88);
      --accent: #38bdf8;
      --border-soft: rgba(148,163,184,0.35);
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      min-height:100vh;
      font-family:system-ui,Apple SD Gothic Neo,Segoe UI,Roboto,sans-serif;
      background:var(--bg-gradient);
      color:#e5e7eb;
      display:flex;
      justify-content:center;
      padding:24px 12px;
    }
    .shell{
      width:100%;
      max-width:960px;
      background:rgba(15,23,42,0.95);
      border-radius:24px;
      border:1px solid var(--border-soft);
      padding:20px;
      display:grid;
      gap:18px;
    }
    @media(min-width:768px){
      .shell{grid-template-columns:3fr 4fr}
    }
    .hero-title{
      font-size:22px;
      font-weight:800;
      display:flex;
      gap:8px;
      align-items:center;
    }
    .hero-sub{
      margin-top:6px;
      font-size:13px;
      color:#9ca3af;
      line-height:1.5;
    }
    .info-card,.auth-card,.shop-card{
      background:var(--card-bg);
      border-radius:18px;
      border:1px solid var(--border-soft);
      padding:14px;
    }
    .collapsed{display:none}
    button{
      cursor:pointer;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.6);
      background:rgba(15,23,42,0.9);
      color:#e5e7eb;
      padding:7px 12px;
      font-size:12px;
    }
    button:hover{border-color:var(--accent)}
    .msg{
      font-size:11px;
      color:#9ca3af;
      min-height:1.4em;
    }
  </style>
</head>

<body>
<div class="shell">

  <!-- 좌측 소개 -->
  <section>
    <div class="hero-title">
      이벤트코인 관리센터
    </div>
    <p class="hero-sub">
      이벤트코인은 <strong>업그레이드 · 시즌 이벤트 · 한정 콘텐츠</strong>에 사용되는 전용 재화입니다.<br/>
      이 페이지에서는 로그인된 게임 계정 기준으로 상태를 관리합니다.
    </p>
  </section>

  <!-- 우측 로그인 -->
  <section>
    <div class="auth-card" id="auth-card">
      <h3>로그인</h3>
      <p class="hero-sub">
        태양계 정복 게임에서 사용하는 계정으로 로그인해 주세요.
      </p>

      <form id="login-form">
        <input id="email" type="email" placeholder="이메일" required style="width:100%;margin-top:8px"/>
        <input id="password" type="password" placeholder="비밀번호" required style="width:100%;margin-top:6px"/>
        <div style="margin-top:8px;display:flex;gap:6px;">
          <button type="submit">이메일 로그인</button>
          <button type="button" id="google-btn">Google 로그인</button>
        </div>
      </form>

      <div class="msg" id="msg"></div>

      <div id="user-box" style="display:none;margin-top:10px;">
        <div style="font-size:11px;color:#9ca3af;">로그인된 계정</div>
        <div id="user-label" style="font-size:12px;"></div>
        <button id="logout-btn" style="margin-top:6px;">로그아웃</button>
      </div>
    </div>

    <!-- 관리 영역 -->
    <div id="purchase-section" class="collapsed">
      <div class="shop-card" style="margin-top:12px;">
        <h3>이벤트코인 · 패키지 상태</h3>
        <p class="hero-sub">
          결제 기능은 비활성화되어 있으며, 이 페이지는 <strong>관리/연동 확인용</strong>입니다.
        </p>
      </div>
    </div>

  </section>
</div>

<!-- ===== Firebase ===== -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
  import {
    getAuth, onAuthStateChanged,
    signInWithEmailAndPassword,
    GoogleAuthProvider,
    signInWithPopup,
    signOut
  } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
  import {
    getDatabase, ref, get
  } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAIrsnUYEBG3cqbPrKD_eejOdtsCDjYG9k",
    authDomain: "siu-studio.firebaseapp.com",
    databaseURL: "https://siu-studio-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "siu-studio",
    storageBucket: "siu-studio.appspot.com",
    messagingSenderId: "830887143444",
    appId: "1:830887143444:web:70b45fc12140e893c31f01"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getDatabase(app);

  const loginForm = document.getElementById('login-form');
  const googleBtn = document.getElementById('google-btn');
  const logoutBtn = document.getElementById('logout-btn');
  const msgBox = document.getElementById('msg');
  const userBox = document.getElementById('user-box');
  const userLabel = document.getElementById('user-label');
  const purchaseSection = document.getElementById('purchase-section');

  function setMsg(t){ msgBox.textContent = t || ''; }

  onAuthStateChanged(auth, async (user)=>{
    if(user){
      loginForm.style.display = 'none';
      userBox.style.display = 'block';
      purchaseSection.classList.remove('collapsed');
      userLabel.textContent = user.email || user.uid;
      setMsg('로그인 완료. 게임 계정 연동 상태를 확인합니다.');

      const mapRef = ref(db,'userServerMap/'+user.uid);
      const snap = await get(mapRef);
      if(!snap.exists()){
        setMsg('⚠ 게임에 아직 접속한 적이 없는 계정입니다.');
      }else{
        setMsg('게임 계정이 정상적으로 연동되어 있습니다.');
      }
    }else{
      loginForm.style.display = 'block';
      userBox.style.display = 'none';
      purchaseSection.classList.add('collapsed');
      setMsg('로그인이 필요합니다.');
    }
  });

  loginForm.addEventListener('submit', async (e)=>{
    e.preventDefault();
    try{
      await signInWithEmailAndPassword(
        auth,
        email.value.trim(),
        password.value.trim()
      );
    }catch(err){
      setMsg('로그인 실패: '+err.code);
    }
  });

  googleBtn.addEventListener('click', async ()=>{
    try{
      await signInWithPopup(auth,new GoogleAuthProvider());
    }catch(err){
      setMsg('Google 로그인 실패');
    }
  });

  logoutBtn.addEventListener('click',()=>signOut(auth));
</script>

</body>
</html>