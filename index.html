<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>ì´ë²¤íŠ¸ì½”ì¸ ìŠ¤í† ì–´</title>

  <!-- PayApp Lite -->
  <script src="https://lite.payapp.kr/public/api/v2/payapp-lite.js"></script>

  <style>
    :root{
      --bg-gradient: radial-gradient(circle at top left,#1f2937,#020617 60%);
      --card-bg: rgba(15,23,42,0.88);
      --accent: #38bdf8;
      --accent-soft: rgba(56,189,248,0.18);
      --border-soft: rgba(148,163,184,0.35);
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      min-height:100vh;
      margin:0;
      font-family:system-ui,Apple SD Gothic Neo,Segoe UI,Roboto,sans-serif;
      background:var(--bg-gradient);
      color:#e5e7eb;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px 12px;
    }
    .shell{
      position:relative;
      width:100%;
      max-width:960px;
      border-radius:24px;
      background:linear-gradient(135deg,rgba(15,23,42,0.97),rgba(15,23,42,0.9));
      box-shadow:0 24px 70px rgba(15,23,42,0.9);
      border:1px solid rgba(148,163,184,0.45);
      padding:20px;
      display:grid;
      gap:18px;
      overflow:hidden;
    }
    @media (min-width:768px){
      .shell{grid-template-columns:3fr 4fr;padding:24px 24px 22px;}
    }

    .hero{position:relative;padding:4px 8px 12px 4px;overflow:hidden;border-radius:18px;}
    .hero-title{display:flex;align-items:center;gap:8px;font-size:22px;font-weight:800;letter-spacing:0.02em;}
    .hero-pill{font-size:11px;padding:3px 9px;border-radius:999px;background:rgba(34,197,94,0.16);border:1px solid rgba(34,197,94,0.7);color:#bbf7d0;}
    .hero-sub{margin-top:8px;font-size:13px;color:#9ca3af;line-height:1.6;}
    .hero-sub strong{color:#e5e7eb;}
    .hero-highlight{margin-top:12px;padding:12px 14px;border-radius:14px;background:linear-gradient(135deg,rgba(8,47,73,0.9),rgba(30,64,175,0.85));border:1px solid rgba(56,189,248,0.8);font-size:13px;box-shadow:0 12px 35px rgba(15,23,42,0.9);}
    .hero-highlight b{color:#e0f2fe;}
    .hero-list{margin-top:10px;display:grid;gap:6px;font-size:12px;color:#cbd5f5;}
    .hero-list li{list-style:none;display:flex;gap:8px;align-items:flex-start;}
    .hero-list span{color:#a5b4fc;font-weight:700;}
    .hero-orbit{position:absolute;right:-40px;bottom:-40px;width:220px;height:220px;background:radial-gradient(circle at 30% 20%,rgba(56,189,248,0.6),transparent 60%),radial-gradient(circle at 80% 80%,rgba(249,115,22,0.55),transparent 55%);opacity:0.9;pointer-events:none;}
    .orbit-ring{position:absolute;inset:34px;border-radius:999px;border:1px dashed rgba(148,163,184,0.4);box-shadow:0 0 24px rgba(15,23,42,0.9) inset;}
    .planet{position:absolute;border-radius:999px;}
    .planet-main{width:46px;height:46px;right:60px;top:32px;background:radial-gradient(circle at 30% 20%,#facc15,#f97316);box-shadow:0 0 28px rgba(250,204,21,0.7);}
    .planet-sub{width:26px;height:26px;right:18px;bottom:52px;background:radial-gradient(circle at 30% 20%,#38bdf8,#6366f1);box-shadow:0 0 20px rgba(56,189,248,0.8);}

    .auth-card,.shop-card{background:var(--card-bg);border-radius:18px;border:1px solid var(--border-soft);padding:14px 14px 12px;display:flex;flex-direction:column;gap:10px;backdrop-filter:blur(18px);}
    .auth-header,.shop-header{display:flex;align-items:center;justify-content:space-between;gap:8px;}
    .auth-title,.shop-title{font-size:15px;font-weight:700;}
    .auth-caption,.shop-sub{font-size:11px;color:#9ca3af;line-height:1.5;}
    .auth-badge{font-size:11px;padding:3px 7px;border-radius:999px;background:rgba(56,189,248,0.12);border:1px solid rgba(56,189,248,0.7);color:#e0f2fe;}
    .shop-toggle{display:inline-flex;align-items:center;gap:6px;border:1px solid rgba(56,189,248,0.7);background:rgba(56,189,248,0.14);color:#e0f2fe;font-weight:700;padding:6px 10px;border-radius:12px;cursor:pointer;transition:transform .14s ease-out, box-shadow .14s ease-out;}
    .shop-toggle:hover{transform:translateY(-1px);box-shadow:0 10px 26px rgba(56,189,248,0.5);}    

    .field{display:flex;flex-direction:column;gap:4px;margin-bottom:6px;}
    .field label{font-size:11px;color:#9ca3af;}
    .field input{padding:8px 10px;border-radius:9px;border:1px solid rgba(75,85,99,0.9);background:rgba(15,23,42,0.9);color:#e5e7eb;font-size:13px;}
    .field input:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 1px rgba(56,189,248,0.4);}

    .btn-row{display:flex;flex-wrap:wrap;gap:6px;margin-top:4px;}
    button{border:none;cursor:pointer;font-size:12px;border-radius:999px;padding:7px 11px;display:inline-flex;align-items:center;gap:4px;white-space:nowrap;transition:transform .14s ease-out,box-shadow .14s ease-out,filter .14s ease-out;}
    .btn-primary{background:linear-gradient(135deg,#38bdf8,#6366f1);color:white;border:1px solid rgba(191,219,254,0.9);box-shadow:0 8px 22px rgba(56,189,248,0.5);}
    .btn-primary:hover{filter:brightness(1.06);transform:translateY(-1px);box-shadow:0 12px 26px rgba(56,189,248,0.7);}
    .btn-secondary{background:rgba(15,23,42,0.9);color:#e5e7eb;border:1px solid rgba(148,163,184,0.7);}
    .btn-secondary:hover{filter:brightness(1.04);transform:translateY(-1px);box-shadow:0 8px 20px rgba(15,23,42,0.8);}

    .msg{margin-top:4px;font-size:11px;min-height:1.3em;color:#9ca3af;}
    .user-bar{margin-top:8px;padding:7px 10px;border-radius:12px;background:rgba(15,23,42,0.96);border:1px solid rgba(148,163,184,0.6);font-size:11px;display:flex;align-items:center;justify-content:space-between;gap:8px;}
    .user-email{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:200px;}

    .packs{margin-top:6px;display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:8px;align-items:stretch;}
    .pack{position:relative;padding:11px;border-radius:16px;background:radial-gradient(circle at top,rgba(56,189,248,0.10),transparent 60%),rgba(15,23,42,0.96);border:1px solid rgba(148,163,184,0.7);display:flex;flex-direction:column;gap:6px;font-size:11px;box-shadow:0 10px 30px rgba(15,23,42,0.75);transition:transform 0.18s ease-out, box-shadow 0.18s ease-out, border-color 0.18s ease-out;}
    .pack:hover{transform:translateY(-4px);border-color:var(--accent);box-shadow:0 16px 40px rgba(15,23,42,0.9);}
    .pack-name{font-weight:600;font-size:13px;display:flex;align-items:center;gap:5px;padding-right:44px;flex-wrap:wrap;}
    .pack-tag{font-size:10px;padding:2px 6px;border-radius:999px;background:rgba(34,197,94,0.16);border:1px solid rgba(34,197,94,0.6);color:#bbf7d0;}
    .pack-amount{color:#e5e7eb;font-size:13px;font-weight:600;}
    .pack-price{font-size:11px;color:#9ca3af;opacity:0.95;}
    .pack-highlight{font-size:10px;color:#a5b4fc;}
    .pack-icon{position:absolute;right:10px;top:8px;font-size:16px;}
    .shop-card.collapsed{display:none;}
    .shop-card.locked{opacity:0.35;pointer-events:none;}

    #toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);padding:10px 14px;border-radius:12px;background:rgba(56,189,248,0.16);border:1px solid rgba(56,189,248,0.7);color:#e0f2fe;font-size:12px;opacity:0;transition:opacity 0.2s ease;backdrop-filter:blur(8px);}
    #toast.show{opacity:1;}
  </style>
</head>
<body>
  <div class="shell">
    <section class="hero">
      <div class="hero-title">
        <span>ì´ë²¤íŠ¸ì½”ì¸ ì„¼í„°</span>
        <span class="hero-pill">ê²Œì„ ì „ìš© í™”í</span>
      </div>
      <p class="hero-sub">
        <strong>ì´ë²¤íŠ¸ì½”ì¸</strong>ì€ ì´ë²¤íŠ¸ ë°°ë„ˆ, í•œì • ìŠ¤í‚¨, ì „ìš© ìƒì ì—ì„œë§Œ ì“°ì´ëŠ” í”„ë¦¬ë¯¸ì—„ í™”íì•¼.
        ê²Œì„ ìš°í¸ìœ¼ë¡œ ë°”ë¡œ ì§€ê¸‰ë˜ê³ , ê³„ì •ì— ì˜êµ¬ ëˆ„ì ë¼ì„œ ì‹œì¦Œì´ ë°”ë€Œì–´ë„ ì‚¬ë¼ì§€ì§€ ì•Šì•„.
      </p>
      <div class="hero-highlight">
        <b>ë¬´ì—‡ì— ì“°ë‚˜ìš”?</b> ì‹œì¦Œ íŒ¨ìŠ¤ ë³´ê°•, í•œì • ë°°ë„ˆ í”½ì—…, ì¬í™” ë¶€ì¡± ì‹œ ì¦‰ì‹œ ë³´ì¶©, íŒ€ì› ì§€ì› ì„ ë¬¼ ë“±ì— ì‚¬ìš©í•  ìˆ˜ ìˆì–´.
      </div>
      <ul class="hero-list">
        <li><span>1.</span> êµ¬ë§¤ ì¦‰ì‹œ <strong>ê²Œì„ ìš°í¸í•¨</strong>ìœ¼ë¡œ ì „ë‹¬ë¼ì„œ ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆì–´.</li>
        <li><span>2.</span> í™˜ê¸‰ì´ë‚˜ ë§Œë£Œ ì—†ì´ <strong>ë‚¨ì€ ì–‘ì´ ê·¸ëŒ€ë¡œ ìœ ì§€</strong>ë¼. ë‹¤ìŒ ì‹œì¦Œ ì¤€ë¹„ìš©ìœ¼ë¡œë„ ì í•©í•´.</li>
        <li><span>3.</span> ëª¨ë“  ê²°ì œëŠ” <strong>PayApp</strong>ì„ í†µí•´ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬ë¼.</li>
      </ul>
      <div style="margin-top:12px;display:flex;gap:10px;align-items:center;">
        <button id="shop-toggle" class="shop-toggle" type="button">ì´ë²¤íŠ¸ì½”ì¸ +</button>
        <span style="font-size:11px;color:#9ca3af;">í•„ìš”í•  ë•Œë§Œ ëˆŒëŸ¬ì„œ íŒ¨í‚¤ì§€ ëª©ë¡ì„ ì—´ì–´ë´.</span>
      </div>
      <div class="hero-orbit">
        <div class="orbit-ring"></div>
        <div class="planet planet-main"></div>
        <div class="planet planet-sub"></div>
      </div>
    </section>

    <section>
      <div class="auth-card" id="auth-card">
        <div class="auth-header">
          <div>
            <div class="auth-title">ë¡œê·¸ì¸</div>
            <div class="auth-caption">ê²Œì„ì—ì„œ ì‚¬ìš©í•˜ëŠ” ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•´ì•¼ ìš°í¸ ì§€ê¸‰ì´ ì •í™•í•˜ê²Œ ì§„í–‰ë¼.</div>
          </div>
          <div class="auth-badge">ê²Œì„ ê³„ì • í•„ìˆ˜</div>
        </div>

        <form id="login-form">
          <div class="field">
            <label for="email">ì´ë©”ì¼</label>
            <input id="email" type="email" autocomplete="email" placeholder="you@example.com" required/>
          </div>
          <div class="field">
            <label for="password">ë¹„ë°€ë²ˆí˜¸</label>
            <input id="password" type="password" autocomplete="current-password" required/>
          </div>
          <div class="btn-row">
            <button type="submit" class="btn-primary">ì´ë©”ì¼ë¡œ ë¡œê·¸ì¸</button>
            <button type="button" id="google-btn" class="btn-secondary">Google ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸</button>
          </div>
        </form>

        <div class="msg" id="msg"></div>

        <div class="user-bar" id="user-box" style="display:none;">
          <div>
            <div style="font-size:10px;color:#9ca3af;">í˜„ì¬ ë¡œê·¸ì¸ëœ ê³„ì •</div>
            <div class="user-email" id="user-label"></div>
          </div>
          <button type="button" id="logout-btn" class="btn-secondary" style="font-size:11px;padding:5px 10px;">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
      </div>

      <div class="shop-card collapsed locked" id="shop-card" aria-hidden="true">
        <div class="shop-header">
          <div>
            <div class="shop-title">ì´ë²¤íŠ¸ì½”ì¸ êµ¬ë§¤</div>
            <div class="shop-sub">ë¡œê·¸ì¸ í›„ ì—´ë¦¼ Â· ê²°ì œ ì™„ë£Œ ì‹œ ì¦‰ì‹œ ìš°í¸ ì§€ê¸‰</div>
          </div>
          <div class="shop-sub" style="text-align:right;color:#fde68a;">ì´ë²¤íŠ¸ ê¸°ê°„ í•œì • x2 VALUE</div>
        </div>

        <div class="packs" id="pay-section">
          <div class="pack" data-tier="starter">
            <div class="pack-icon">âœ¨</div>
            <div class="pack-name">ìŠ¤íƒ€í„° ë¬¶ìŒ <span class="pack-tag">ì…ë¬¸ìš©</span></div>
            <div class="pack-amount">ì´ë²¤íŠ¸ì½”ì¸ 120ê°œ</div>
            <div class="pack-price">â‚©1,100 Â· ì†Œì†Œí•˜ê²Œ ì‹œì‘í•˜ê¸°</div>
            <div class="pack-highlight">íŠœí† ë¦¬ì–¼Â·ì‘ì€ ë²„í”„ìš©ì— ì ë‹¹í•œ êµ¬ì„±.</div>
            <button onclick="startPay('eco-120')">120 EC êµ¬ë§¤</button>
          </div>

          <div class="pack" data-tier="bag">
            <div class="pack-icon">ğŸ’</div>
            <div class="pack-name">ì‘ì€ ìë£¨ <span class="pack-tag">x2 VALUE</span></div>
            <div class="pack-amount">ì´ë²¤íŠ¸ì½”ì¸ 300ê°œ</div>
            <div class="pack-price">â‚©2,200 Â· ê°€ì„±ë¹„ íŒ¨í‚¤ì§€</div>
            <div class="pack-highlight">ì´ë²¤íŠ¸ ì „ìš© ìƒì ì—ì„œ ì²´ê° ê°€ì¹˜ ìƒìŠ¹.</div>
            <button onclick="startPay('eco-300')">300 EC êµ¬ë§¤</button>
          </div>

          <div class="pack" data-tier="bag" data-feature="popular">
            <div class="pack-icon">ğŸ§º</div>
            <div class="pack-name">ì¤‘í˜• ìë£¨ <span class="pack-tag">ì¶”ì²œ</span></div>
            <div class="pack-amount">ì´ë²¤íŠ¸ì½”ì¸ 700ê°œ</div>
            <div class="pack-price">â‚©4,400 Â· í•œì • ìƒì  ëŒ€ë¹„ ìµœì </div>
            <div class="pack-highlight">ì´ë²¤íŠ¸ í•œ ë²ˆì€ ë„‰ë„‰í•˜ê²Œ ì¦ê¸¸ ìˆ˜ ìˆëŠ” ì–‘.</div>
            <button onclick="startPay('eco-700')">700 EC êµ¬ë§¤</button>
          </div>

          <div class="pack" data-tier="bigbag">
            <div class="pack-icon">ğŸ’°</div>
            <div class="pack-name">ëŒ€í˜• ìë£¨ <span class="pack-tag">x2 VALUE</span></div>
            <div class="pack-amount">ì´ë²¤íŠ¸ì½”ì¸ 1,600ê°œ</div>
            <div class="pack-price">â‚©8,800 Â· ìì£¼ í•˜ëŠ” ìœ ì €ìš©</div>
            <div class="pack-highlight">ìš°ì£¼ì„ Â·ë°°ë„ˆ ì´ë²¤íŠ¸ë¥¼ ì—¬ìœ  ìˆê²Œ ëŒ€ë¹„.</div>
            <button onclick="startPay('eco-1600')">1,600 EC êµ¬ë§¤</button>
          </div>

          <div class="pack" data-tier="chest">
            <div class="pack-icon">ğŸ“¦</div>
            <div class="pack-name">ë³´ë¬¼ ìƒì <span class="pack-tag">ê³ ê¸‰</span></div>
            <div class="pack-amount">ì´ë²¤íŠ¸ì½”ì¸ 3,600ê°œ</div>
            <div class="pack-price">â‚©18,000 Â· í—¤ë¹„ ìœ ì € íŒ¨í‚¤ì§€</div>
            <div class="pack-highlight">2~3íšŒ ëŒ€í˜• ì´ë²¤íŠ¸ë¥¼ í•œ ë²ˆì— ì¤€ë¹„.</div>
            <button onclick="startPay('eco-3600')">3,600 EC êµ¬ë§¤</button>
          </div>

          <div class="pack" data-tier="vault" data-feature="best">
            <div class="pack-icon">ğŸ¦</div>
            <div class="pack-name">ìš°ì£¼ ì°½ê³  <span class="pack-tag">ìµœê³  ê°€ì¹˜</span></div>
            <div class="pack-amount">ì´ë²¤íŠ¸ì½”ì¸ 8,000ê°œ</div>
            <div class="pack-price">â‚©39,000 Â· ì¥ê¸° íˆ¬ììš©</div>
            <div class="pack-highlight">ì¥ê¸°ì ì¸ í•œì • ì½˜í…ì¸  ëŒ€ë¹„, ìµœëŒ€ í˜œíƒ.</div>
            <button onclick="startPay('eco-8000')">8,000 EC êµ¬ë§¤</button>
          </div>

          <div class="pack" data-tier="chest">
            <div class="pack-icon">ğŸŒŒ</div>
            <div class="pack-name">ì½”ìŠ¤ë¯¹ ë²ˆë“¤ <span class="pack-tag">ì¥ê¸° ì´ë²¤íŠ¸</span></div>
            <div class="pack-amount">ì´ë²¤íŠ¸ì½”ì¸ 5,000ê°œ</div>
            <div class="pack-price">â‚©25,000 Â· ì´ë²¤íŠ¸ ì‹œì¦Œ ëŒ€ë¹„ìš©</div>
            <div class="pack-highlight">ì—¬ëŸ¬ ì‹œì¦Œì„ í•œ ë²ˆì— ì¤€ë¹„í•˜ëŠ” ê¾¸ì¤€í•œ ìœ ì €ì—ê²Œ ì ë‹¹í•œ êµ¬ì„±.</div>
            <button onclick="startPay('eco-5000')">5,000 EC êµ¬ë§¤</button>
          </div>

          <div class="pack" data-tier="ultra">
            <div class="pack-icon">ğŸŒ€</div>
            <div class="pack-name">ê°¤ëŸ­ì‹œ ì°½ê³  <span class="pack-tag">ULTRA</span></div>
            <div class="pack-amount">ì´ë²¤íŠ¸ì½”ì¸ 12,000ê°œ</div>
            <div class="pack-price">â‚©69,000 Â· ìµœìƒìœ„ ìœ ì €ìš©</div>
            <div class="pack-highlight">ëª¨ë“  ì´ë²¤íŠ¸ë¥¼ ì—¬ìœ  ìˆê²Œ ì¦ê¸°ë ¤ëŠ” ìµœìƒìœ„ íŒ¨í‚¤ì§€.</div>
            <button onclick="startPay('eco-12000')">12,000 EC êµ¬ë§¤</button>
          </div>
        </div>
      </div>
    </section>
  </div>

  <div id="toast"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
    import {
      getAuth, onAuthStateChanged,
      signInWithEmailAndPassword,
      GoogleAuthProvider,
      signInWithPopup,
      signOut
    } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAIrsnUYEBG3cqbPrKD_eejOdtsCDjYG9k",
      authDomain: "siu-studio.firebaseapp.com",
      databaseURL: "https://siu-studio-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "siu-studio",
      storageBucket: "siu-studio.appspot.com",
      messagingSenderId: "830887143444",
      appId: "1:830887143444:web:70b45fc12140e893c31f01",
      measurementId: "G-1Y090YJDB6"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    const loginForm  = document.getElementById('login-form');
    const googleBtn  = document.getElementById('google-btn');
    const logoutBtn  = document.getElementById('logout-btn');
    const msgBox     = document.getElementById('msg');
    const userBox    = document.getElementById('user-box');
    const userLabel  = document.getElementById('user-label');
    const shopCard   = document.getElementById('shop-card');
    const toastBox   = document.getElementById('toast');
    const shopToggle = document.getElementById('shop-toggle');

    const PAYAPP_USERID = 'siustudio';

    const PACKS = {
      "eco-120":  { kind:"eco",  priceKRW: 1100,  ecoins: 120,  title: "ìŠ¤íƒ€í„° ë¬¶ìŒ" },
      "eco-300":  { kind:"eco",  priceKRW: 2200,  ecoins: 300,  title: "ì´ë²¤íŠ¸ì½”ì¸ ì‘ì€ ìë£¨" },
      "eco-700":  { kind:"eco",  priceKRW: 4400,  ecoins: 700,  title: "ì´ë²¤íŠ¸ì½”ì¸ ì¤‘í˜• ìë£¨" },
      "eco-1600": { kind:"eco",  priceKRW: 8800,  ecoins: 1600, title: "ì´ë²¤íŠ¸ì½”ì¸ ëŒ€í˜• ìë£¨" },
      "eco-3600": { kind:"eco",  priceKRW: 18000, ecoins: 3600, title: "ì´ë²¤íŠ¸ì½”ì¸ ë³´ë¬¼ ìƒì" },
      "eco-8000": { kind:"eco",  priceKRW: 39000, ecoins: 8000, title: "ì´ë²¤íŠ¸ì½”ì¸ ìš°ì£¼ ì°½ê³ " },
      "eco-5000": { kind:"eco",  priceKRW: 25000, ecoins: 5000,  title: "ì½”ìŠ¤ë¯¹ ë²ˆë“¤" },
      "eco-12000":{ kind:"eco",  priceKRW: 69000, ecoins: 12000, title: "ê°¤ëŸ­ì‹œ ì°½ê³ " }
    };

    function setMsg(text){
      if(!msgBox) return;
      msgBox.textContent = text || '';
    }
    function showToast(message, timeoutMs = 4000){
      if(!toastBox) return;
      toastBox.textContent = message;
      toastBox.classList.add('show');
      if(timeoutMs > 0){
        setTimeout(()=>toastBox.classList.remove('show'), timeoutMs);
      }
    }
    function setShopVisibility(show){
      if(!shopCard) return;
      shopCard.classList.toggle('collapsed', !show);
      shopCard.setAttribute('aria-hidden', show ? 'false' : 'true');
      if(shopToggle){
        shopToggle.textContent = show ? 'ì´ë²¤íŠ¸ì½”ì¸ âˆ’' : 'ì´ë²¤íŠ¸ì½”ì¸ +';
      }
    }
    function setShopEnabled(enabled){
      if(!shopCard) return;
      shopCard.classList.toggle('locked', !enabled);
    }

    shopToggle?.addEventListener('click', ()=>{
      const open = shopCard?.classList.contains('collapsed') === false;
      setShopVisibility(!open);
    });

    onAuthStateChanged(auth, (user)=>{
      if(user){
        if(userBox) userBox.style.display = '';
        if(userLabel) userLabel.textContent = user.email || user.uid;
        setMsg('ë¡œê·¸ì¸ ì™„ë£Œ! ì›í•˜ëŠ” ì´ë²¤íŠ¸ì½”ì¸ì„ ì„ íƒí•˜ë©´ ë°”ë¡œ ê²°ì œí•  ìˆ˜ ìˆì–´.');
        setShopEnabled(true);
      }else{
        if(userBox) userBox.style.display = 'none';
        if(userLabel) userLabel.textContent = '';
        setMsg('ë¡œê·¸ì¸ í›„ ì´ë²¤íŠ¸ì½”ì¸ì„ êµ¬ë§¤í•´ ì¤˜.');
        setShopEnabled(false);
      }
    });

    loginForm?.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const email = (document.getElementById('email')?.value || '').trim();
      const pw    = (document.getElementById('password')?.value || '').trim();
      if(!email || !pw){
        setMsg('ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ ì¤˜.');
        return;
      }
      try{
        setMsg('ë¡œê·¸ì¸ ì¤‘...');
        await signInWithEmailAndPassword(auth,email,pw);
      }catch(err){
        console.error(err);
        setMsg('ë¡œê·¸ì¸ ì‹¤íŒ¨: '+(err.code || err.message));
      }
    });

    googleBtn?.addEventListener('click', async ()=>{
      try{
        setMsg('Google ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸ ì¤‘...');
        const provider = new GoogleAuthProvider();
        await signInWithPopup(auth,provider);
      }catch(err){
        console.error(err);
        setMsg('Google ë¡œê·¸ì¸ ì‹¤íŒ¨: '+(err.code || err.message));
      }
    });

    logoutBtn?.addEventListener('click', async ()=>{
      try{ await signOut(auth); }catch(err){ console.error(err); }
    });

    window.startPay = function startPay(packId){
      const user = auth.currentUser;
      if(!user){
        alert('ë¨¼ì € ë¡œê·¸ì¸í•´ ì¤˜. (ê²Œì„ì—ì„œ ì“°ëŠ” ê³„ì •ê³¼ ê°™ì€ ê³„ì •ì´ì–´ì•¼ í•´)');
        return;
      }
      const p = PACKS[packId];
      if(!p){
        alert('ì•Œ ìˆ˜ ì—†ëŠ” ìƒí’ˆì…ë‹ˆë‹¤.');
        return;
      }

      const redirect = new URL('/',location.origin);
      redirect.hash = '#pay-done';

      const meta = {
        v: 2,
        uid: user.uid,
        packId,
        kind: p.kind,
        priceKRW: p.priceKRW,
        ecoins: p.ecoins || 0,
        t: Date.now()
      };

      try{
        showToast('PayApp ê²°ì œì°½ì„ ì—¬ëŠ” ì¤‘...',4000);
        PayApp
          .setParam('userid',PAYAPP_USERID)
          .setParam('shopname','ì´ë²¤íŠ¸ì½”ì¸ ìŠ¤í† ì–´')
          .setParam('goodname',p.title)
          .setParam('price',String(p.priceKRW))
          .setParam('feedbackurl',location.origin+'/api/payapp/feedback')
          .setParam('redirecturl',redirect.toString())
          .setParam('buyerid',user.uid)
          .setParam('var1',JSON.stringify(meta))
          .payrequest();
      }catch(err){
        console.error(err);
        alert('ê²°ì œë¥¼ ì‹œì‘í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    };

    setShopVisibility(false);
    setShopEnabled(false);
  </script>
</body>
</html>
